---
layout: post
title:  "Web网络基础概述"
categories: Web
tags:  Web HTTP
author: Chester Cheung
---

* content
{:toc}

## Web网络

Web是website(网站)的简称，你知道我们平时在网站上地址栏中输入网址时，web界面是如何呈现的吗，你知道你的每一次点击都会传递出什么信息吗？


web页面上的内容当然不能凭空产生，简单来说，在地址栏中输入指定的URL后，浏览器从web的服务器端获取到文件资源等信息，进而把信息呈现在网站页面上。通常我们把用户使用的能够发出请求命令的web浏览器称作客户端，客户端把请求命令发送给服务器，服务器将传递过来的命令转存到数据库，我们在大学学习的通常都是Mysql，但现在在互联网公司使用的大都是Nosql，但本质上语言都是大同小异的。服务器通常将HTTP协议(HyperText Transfer Protocol )作为网络通信的规范，所以可以说web就是建立在HTTp协议上进行通信的。


我也仍然在学习的过程中，对于Mysql、HTTP、TCP/IP等了解还有待进一步提高，在这里就把我自己浅显的认识写下来，供大家谈论、批评。









在HTTP诞生之前，互联网还是属于少数人的概念，直到超文本的概念被提出来，形成了所谓的WWW万维网后， 互联网才开始逐渐走进大众的事业。HTTP问世于1990年，当时还没有被作为正式的标准建立，因此被称为HTTP/0.9，在1996年5月被正式建立，命名为HTTP/1.0，该版本的HTTP至今仍广泛应用于服务器端，1997年发布的HTTP/1.1版本就是目前主流的最新版本。



在了解HTTP之前，有必要先了解下TCP/IP协议族。我们日常使用的绝大多数网络(包括互联网)都是在TCP/IP族协议的基础上运作的，HTTP也是TCP/IP内部的一个子集。



计算机及相关设备要进行工作，就一定要基于相同的方法，在所有方面比如，由哪一边发起通信、使用哪种语言进行信息传递、如何结束通信等都要事先确定，不同的硬件、操作系统之间都要遵循这种规则，这种规则就称为协议(Protocol)。广义的来说，TCP/IP协议族就是互联网上所有相关各类协议族的总称；狭义的说，TCP/IP也可以指TCP和IP两种协议本身。



TCP/IP协议的一个重要的特征就是**分层管理**，按照层次分为了4层：应用层、传输层、网络层、数据链路层。这种分层的操作能带来不少好处，如果互联网只由一个协议统筹管理，那么某个地方需要修改时，就必须要把整体都替换掉，会加大工作量；但是分层之后就只需将所在层替换掉就好了，极大的方便了互联网协议的修改；将各层之间的接口规划好以后，每个层次内部就可以随意改动了。分层之后，各个层之间的工作也相对变得容易，一个层只需要考虑给他分配的任务就ok，不用去理会其他层是怎样工作的。这里有点类似我们计算机编程语言中的封装处理。



## 下面分别介绍下TCP/IP协议族各层的作用。



**应用层**：



直接面向用户，为用户提供通信服务，其中典型的服务就是HTTP、FTP和DNS，

**传输层**：

对接上层应用层，提供处于网络连接中的两台计算机之间的数据传输，主要有两个协议，TCP和UDP。

**网络层**：

用来处理网络上流动的数据包，该层规定了通过怎样的路径传输数据包的。


**链路层**：

用来处理网络连接的硬件部分，包括底层基础的架构，比如操作系统、硬件光驱、甚至架设的光纤光缆，以及一切物质的传输媒介。
这个实在网上找到的TCP/IP通信的传输流：

![1](https://img-blog.csdnimg.cn/2019032520320516.PNG?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDM5MDE0NQ==,size_16,color_FFFFFF,t_70)

在利用TCP/IP进行网络通信时，会逐层按顺序与对方进行通信，发送端从应用层到链路层，接收端从链路层到应用层。



这里按照命令处理的逻辑顺序走一遍。当用户在网站上输入地址后，客户端就发出了浏览某个web界面的HTTP请求；为了便于传输，在传输层通过TCP协议把从应用层接收到的数据进行分割，在各个报文上做好标记序号后发给网络层；网络层给数据附加作为通信地址的MAC地址后转发给链路层，这样就贯穿了整个TCP/IP层接收端的服务器在链路层接收到数据后，按照原路进行返回发送，当数据传输到链路层后，才算真正接收到客户端发过来的HTTP请求。

![2](https://img-blog.csdnimg.cn/20190325210719515.PNG?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDM5MDE0NQ==,size_16,color_FFFFFF,t_70)

**发送端在发送信息的过程中，每经过一层就会把该层的首部信息附加到相关数据上；相反，接收端接受到数据信息时，也经过一层层而脱去带着的首部信息。**


## 下面简单介绍几个重要的协议：


**IP协议——负责进行传输**


IP协议位于网络层，从TCP/IP的名字就能看出来，IP的重要性占到了多大的分量。但是这里要做一个区分，我们这里说的IP不是指IP地址，IP地址仅仅指明了节点被分配到的地址，而IP协议是确保将数据传输到对方那里的协议，其中重要的条件就是IP地址和MAC地址，因此，IP协议包括IP地址。



IP地址指明了节点被分配到的地址，而MAC地址则是网卡所属的固定地址，IP地址可以和MAC地址进行配对，IP地址可以更换，但是MAC地址是不能更换的。


IP之间的通信发生在同一个局域网内的概率很小的，通常都需要多台计算机进行转接才能进行通信。在中转过程中，会利用下一站中转设备的MAC地址来搜索他的下一个中转目标，此时就会采用ARP协议(ARP是一种解析地址的协议，通过ARP解析后，根据对方的IP地址就能反查出该IP对应的MAC地址)。


**TCP协议——确保数据到达**


TCP位于传输层，主要提供可靠的字节流服务，就是在传输过程中，为了方便传输，将大块的数据分割成小的方面分开进行传输，这种分割传输较为精准。一句话概括，就是TCP为了能传输大数据才将数据进行分割，同时TCP协议能够确保数据是否准确到达了对方那里。


为了确定传输的准确性，TCP协议采取了三次握手的策略：TCP将数据传输出去后，他回向对方发送带SYN标志的数据包给接收端，接收端接收到后，回传一个带有SYN/ACK的数据包，用来传达确认信息，然后发送端再次发送ACK数据包给接收端，此时代表握手结束。

**DNS——负责解析域名和IP地址**


DNS和HTTP一样位于应用层，他主要提供域名和IP地址之间的解析服务。计算机既可以被赋予IP地址，也可以被赋予域名和主机名，IP地址通常都是一串带点的数字，比如“192.163.65.168”；而域名则是我们通常看到的网址，比如“www.baidu.com”。人们通常不喜欢使用数字来进行IP访问，相比之下，大家都更偏向于使用域名，但是计算机不能识别出域名。为了协调解决上面这个问题，DNS服务诞生了，DNS可以提供从IP到域名、和从域名到IP的双向查询服务。

### 常用HTTP状态码

HTTP命令|作用
--|:--:
OPTIONS|设置选项
GET|获取制定的URL地址
HEAD|仅获取文档的首部
POST|请求服务器接受URL指定的文档作为可执行的信息
PUT|请求服务器保存客户端传输的数据到URL指定的文档
DELETE|请求服务器删除URL指定的界面
TRACE|请求消息返回客户端

> 1XX:  消息提供（通知）

100：Continue
客户端应重新发送初始请求，并在请求中附上第一次请求时未提供的（可能很大或者包含敏感信息的）表示。客户端这次发送的请求不会被拒绝。

> 2XX：肯定应答（成功）

200：OK
这是客户端希望看到的响应代码。它表示服务器成功执行了客户端所请求的动作，并且在2XX系列里没有其他更适合的响应代码了。

201：Create
当服务器依照客户端的请求创建了一个新资源时，发送此响应代码。

202：Accepted
客户端的请求无法或将不被实时处理。请求稍后会被处理。请求看上去是合法的，但在实际处理它时有出现问题的可能。
若一个请求触发了一个异步操作，或者一个需要现实世界参与的动作，或者一个需要很长时间才能完成且没必要让Web客户端一直等待的动作时，这个相应代码是一个合适的选择。

204：Not Content
若服务器拒绝对PUT、POST或者DELETE请求返回任何状态信息或表示，那么通常采用此响应代码。服务器也可以对GET请求返回此响应代码，这表明“客户端请求的资源存在，但其表示是空的”。注意与304("Not Modified")的区别。204常常用在Ajax应用里。服务器通过这个响应代码告诉客户端：客户端的输入已被接受，但客户端不应该改变任何UI元素。

> 3XX：重定向请求

301：Moved Permanently
服务器知道客户端试图访问的是哪个资源，但它不喜欢客户端用当前URI来请求该资源。它希望客户端记住另一个URI，并在今后的请求中使用那个新的URI。你可以通过这个响应代码来防止由于URI变更而导致老URI失效。

> 4XX：客户端请求出现错误

400：Bad Request
这是一个通用的客户端错误状态，当其他4XX响应代码不适用时，就采用400。此响应代码通常用于“服务器收到客户端通过PUT或者POST请求提交的表示，表示的格式正确，但服务器不懂它什么意思”的情况。

401：Unauthorized
客户端试图对一个受保护的资源进行操作，却又没有提供正确的认证证书。客户端提供了错误的证书，或者根本没有提供证书。这里的证书（credential）可以是一个用户名/密码，也可以市一个API key，或者一个认证令牌。客户端常常通过向一个URI发送请求，并查看收到401响应，以获知应该发送哪种证书，以及证书的格式。如果服务器不想让未授权的用户获知某个资源的存在，那么它可以谎报一个404而不是401。这样做的缺点是：客户端需要事先知道服务器接受哪种认证

403：Forbidden
客户端请求的结构正确，但是服务器不想处理它。这跟证书不正确的情况不同--若证书不正确，应该发送响应代码401。该响应代码常用于一个资源只允许在特定时间段内访问，
或者允许特定IP地址的用户访问的情况。403暗示了所请求的资源确实存在。跟401一样，若服务器不想透露此信息，它可以谎报一个404。既然客户端请求的结构正确，那为什么还要把本响应代码放在4XX系列（客户端错误），而不是5XX系列（服务端错误）呢？因为服务器不是根据请求的结构，而是根据请求的其他方面（比如说发出请求的时间）作出的决定的。

404：Not Found
这也许是最广为人知的HTTP响应代码了。404表明服务器无法把客户端请求的URI转换为一个资源。相比之下，410更有用一些。web服务可以通过404响应告诉客户端所请求的URI是空的，然后客户端就可以通过向该URI发送PUT请求来创建一个新资源了。但是404也有可能是用来掩饰403或者401。

405：Method Not Allowd
客户端试图使用一个本资源不支持的HTTP方法。例如：一个资源只支持GET方法，但是客户端使用PUT方法访问。

409：Conflict
此响应代码表明：你请求的操作会导致服务器的资源处于一种不可能或不一致的状态。例如你试图修改某个用户的用户名，而修改后的用户名与其他存在的用户名冲突了。

> 5XX：服务端错误
> 意味着服务器处于不能执行客户端请求的状态，此时客户端应稍后重试。

500：Internal Server Error
这是一个通用的服务器错误响应。对于大多数web框架，如果在执行请求处理代码时遇到了异常，它们就发送此响应代码。

501：Not Complement
客户端试图做一个采用了拓展HTTP方法的请求，而普通web服务器不支持此请求。它跟响应代码405比较相似，405表明客户端所用的方法是一个可识别的方法，但该资源不支持，而501表明服务器根本不能识别该方法。

504：Bad Gateway
只有HTTP代理会发送这个响应代码。它表明代理方面出现问题，或者代理与上行服务器之间出现问题，而不是上行服务器本身有问题。若代理根本无法访问上行服务器，响应代码将是504。

503：Server Unavailable
此响应代码表明HTTP服务器正常，只是下层web服务服务不能正常工作。最可能的原因是资源不足：服务器突然收到太多请求，以至于无法全部处理。由于此问题多半由客户端反复发送请求造成，因此HTTP服务器可以选择拒绝接受客户端请求而不是接受它，并发送503响应代码。


## 简单介绍下URI和URL：

URI：统一资源标识符

URL：统一资源定位符
我们日常使用浏览器访问web页面时需要输入的就是URL，比如"http:/baidu.com"。


### URL请求的全过程

1. DNS域名解析

2. 建立TCP连接（三次握手）

3. 发送请求--tomcat进行处理

4. 四次挥手关闭连接 

> DNS域名解析

1、浏览器会检查缓存中有没有这个域名对应的解析过的IP地址，如果有，这个解析过程就结束。

2、缓存中没有数据，浏览器会查找操作系统缓存中是否有这个域名对应的DNS解析结果。

3、前两个无法解析时，就要用到本地区的域名服务器。它们一般都会缓存域名解析结果。大约80%的域名解析到这里就结束了，所以LDNS主要承担了域名的解析工作。

4、如果LDNS仍然没有，就直接到Root Server域名服务器请求解析。

5、根域名服务器返回给本地域名服务器一个所查询的主域名服务器（gTLD Server）地址。

6、本地域名服务器LDNS再向上一步返回的gTLD服务器发送请求。

7、主域名服务器查找并返回此域名对应的Name Server域名服务器的地址，这个Name Server通常就是用户注册的域名服务器。

8、域名服务器会查询存储的域名和IP的映射关系表，在正常情况下都根据域名得到目标IP地址，连同一个TTL值返回给LDNS Server域名服务器。

9、返回该域名对应的IP和TTL值，LDNS会缓存这个域名和IP的对应关系，缓存时间由TTL值控制。

10、把解析的结果返回给用户，用户根据TTL值缓存在本地系统缓存中，域名解析过程结束。

> 建立TCP连接

1、第一次握手：
Client将标志位SYN置为1，随机产生一个值seq=J，并将该数据包发送给Server，Client进入SYN_SENT状态，等待Server确认。

2、第二次握手：
Server收到数据包后由标志位SYN=1知道Client请求建立连接，Server将标志位SYN和ACK都置为1，ack=J+1，随机产生一个值seq=K，并将该数据包发送给Client以确认连接请求，Server进入SYN_RCVD状态。

3、第三次握手：
Client收到确认后，检查ack是否为J+1，ACK是否为1，如果正确则将标志位ACK置为1，ack=K+1，并将该数据包发送给Server，Server检查ack是否为K+1，ACK是否为1，如果正确则连接建立成功，Client和Server进入ESTABLISHED状态，完成三次握手，随后Client与Server之间可以开始传输数据了。

> 四次挥手

1、第一次挥手：TCP发送一个FIN(结束)，用来关闭客户到服务端的连接。

2、第二次挥手：服务端收到这个FIN，他发回一个ACK(确认)，确认收到序号为收到序号+1，和SYN一样，一个FIN将占用一个序号。

3、第三次挥手：服务端发送一个FIN(结束)到客户端，服务端关闭客户端的连接。

4、第四次挥手：客户端发送ACK(确认)报文确认，并将确认的序号+1，这样关闭完成。



（相关参考书籍：图解HTTP协议	[上野宣] 人民邮电出版社）
