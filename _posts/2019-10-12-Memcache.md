---
layout: post
title:  "Nosql之Memcache"
categories: database
tags: database Nosql
author: Chester Cheung
---

* content
{:toc}

Memcached是一种非常简单也是入门级别的key-value数据库，属于nosql一个比较简单可用的例子，在这里快速学习下，为学习其他数据库进行一个准备......

### Memcached语法

Memcached基础语法很少，基本只有很简单的一些，只要把常用的掌握就OK：

```php
telnet localhost 11211
```






先连接上localhost的11211，是memcached的默认端口，连接上后即可直接输入memcached命令；然后通过set和get这两个配套的命令可以设置和查询到对应的key，value对的值是多少

```php
set ‘key’ 'flag' 'expires' 'byte'

get 'key'
```

然后通过incr和append命令可以给key对应的value增加值或者字符串

```php
incr 'key' 'num'

append 'key' 'string' 'expires' 'byte'
```

还有delete和flush_all可以分别删除一个或者全局的所有key

```php
delete 'key'

flush_all
```

以上就是memcached的常用命令，简单吧～

### 安装memcached相关包(针对macOS平台)：

首先ruby是必备的环境(macOS默认自带ruby)

> $ brew install ruby

安装ruby的依赖包

> $ brew install rubygems

注意下一步可能有安装权限问题，可以通过sudo gem install memcach-client

> $ gem install memcach-client

### 单节点测试Ruby程序

```php

$KCODE='u'

require "rubygems"
require "memcache"

server=['localhost:11211']
option={}

cache=MemCache.new(server,option)

cache['key1']=123
cache['key2']="ABCDE"
cache['key3']=%w(hoge fuga)
cache['key4']={:foo=>1,:bar=>"a"}

p cache['key1']
p cache['key2']
p cache['key3']
p cache['key4']

```

![2019-10-12-1](https://zhyChesterCheung.github.io/photos/2019-10-12-1)

### 用Ruby测试多个memcached节点

> 节点分配算法：**一致性哈希算法**

监听端口: 11211，11212，11213

```php
require "rubygems"
require "memcache"
require "logger"

server=['localhost:11211','localhost:11212','localhost:11213']

option={
    :logger=>Logger.new(STDOUT)
}

cache=MemCache.new(server,option)

cache['key1']=123
cache['key2']="ABCDE"
cache['key3']=%w(hoge fuga)
cache['key4']={:foo=>1,:bar=>"a"}

p cache['key1']
p cache['key2']
p cache['key3']
p cache['key4']
```

![2019-10-12-2](https://zhyChesterCheung.github.io/photos/2019-10-12-2.png)

### 模拟失去一个节点

```php
require "rubygems"
require "memcache"
require "logger"

server=['localhost:11212','localhost:11213']

option={
    :logger=>Logger.new(STDOUT)
}

cache=MemCache.new(server,option)

cache['key1']=123
cache['key2']="ABCDE"
cache['key3']=%w(hoge fuga)
cache['key4']={:foo=>1,:bar=>"a"}

p cache['key1']
p cache['key2']
p cache['key3']
p cache['key4']
```

![2019-10-12-3](https://zhyChesterCheung.github.io/photos/2019-10-12-3.png)

